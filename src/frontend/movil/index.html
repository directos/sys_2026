<!DOCTYPE html>
<html lang="es">

<head>
    <script src="https://cdn.lr-intake.com/LogRocket.min.js" crossorigin="anonymous"></script>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href=".">
    <script> //window.onload = function () { if (!window.location.hash) { window.location = window.location + '#fresh'; window.location.reload(); throw new Error("No hay error, solo estamos recargando..."); } } // Traemos siempre una versión fresca de esta página, por si nuestra app tiene una versión más reciente que debamos cargar.</script>
    <title>Sys (movil)</title>
    <meta name="description" content="Sistema de gestión empresarial">

    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate, post-check=0, pre-check=0" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="expires" content="0" /> <!-- content='-1'> -->
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <meta name="robots" content="noindex, nofollow, noarchive, noodp, noydir">
    <meta name="author" content="Orlando Arteaga, Shasling Pamela">
    <meta name="apple-mobile-web-app-title" content="Sys">
     <meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel= "apple-touch-icon" href="../assets/icons/apple-touch-icon-192x192.png">
    <link rel= "icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="manifest" crossorigin="use-credentials" href="../manifest.json"/>

    <script src="../assets/lib/rollbar/rollbar.js"></script>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js" integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
    <link  href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
    <link  href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link href= "https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.min.css" rel="stylesheet" />
    <script async src="https://maps.googleapis.com/maps/api/js?libraries=geometry&callback=Function.prototype&key=AIzaSyBRdBiUDmR9A9_vu38iTVOW7-rwoYyBSrc" type="text/javascript"></script>

    <script src="../assets/lib/dexie/dexie.min.js"></script>    <!--<script src="https://unpkg.com/dexie@latest/dist/dexie.js" crossorigin="anonymous"></script>-->
    <script src="../assets/lib/offline/offline.min.js"></script>
    <script src="../assets/lib/offline/reconnect.js"></script>
    <script src="../assets/lib/offline/requests.js"></script>
    <link href= "../assets/lib/offline/offline-theme-chrome-indicator.css" rel="stylesheet" type="text/css"/>
    <link href= "../assets/lib/offline/offline-language-spanish-indicator.css" rel="stylesheet" type="text/css"/> 

    <script src="../assets/lib/touch-punch/touch-punch.min.js"></script>
    <script src="../assets/lib/datejs/date-es-CR.js"></script>
    <script src="../assets/lib/detectjs/detect.js"></script>
    <script src="../assets/lib/jwt-decode/jwt-decode.min.js"></script>
    <script src="../assets/lib/jsbarcode/JsBarcode.all.min.js"></script>
    <script src="../assets/lib/signature_pad/signature_pad.umd.js"></script>
    
    <script src="../assets/lib/jq-search/jquery.highlight.js"></script>
    <script src="../assets/lib/jq-search/jquery.finder.js"></script>
    <link href= "../assets/lib/jq-search/style-movil.css" rel="stylesheet" type="text/css"/>    

    <script src="../assets/lib/printjs/print.min.js"></script>
    <link href= "../assets/lib/printjs/print.min.css" rel="stylesheet" type="text/css"/>
    <link href= "../assets/lib/pacman/pacman.min.css" rel="stylesheet" type="text/css" />
</head>

<body style="background-color: whitesmoke;">

    <!-- Contenido -->
    <div id="div-movil-content" class="content px-1" data-finder-content></div>
        
    <!-- Para almacenar los datos de geolocation 
    <div id="div-geolocation" class="bg-dark text-light text-monospace small p-3 mt-5">
        <div class="row">
            <div class="col-auto">
                <div>Ubicación:</div>
                <div>Altitud:</div>
                <div>Rumbo:</div>
                <div>Velocidad:</div>
                <div>Precisión:</div>
            </div>
            <div class="col">
                <div id="div-geolocation-coordenadas"></div>
                <div id="div-geolocation-altitud"></div>
                <div id="div-geolocation-rumbo"></div>
                <div id="div-geolocation-velocidad"></div>
                <div id="div-geolocation-precision"></div>
            </div>
        </div>
    </div>-->

    <!-- MODALS -->

    <!-- Modal mensaje genérico -->
    <div class="modal fade zindex-sobrecontrato con-backdrop" id="modal-app-mensaje" tabindex="-1" role="dialog" aria-labelledby="ModalProcesoError_label" aria-hidden="true" style="z-index:2001;">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-info-circle-fill pr-2"></i><span class="titulo">Título</span></h5>
                    <button type="button" class="close btn-modal-cerrar _trackear" data-dismiss="modal" aria-label="Close" data-tracker=""><i class="bi bi-x-lg pl-2"></i></button>
                </div>
                <div class="modal-body">
                    <div class="spinner-border text-success d-none pr-3 modal-app-spinner" role="status"><span class="sr-only">Procesando...</span></div>
                    <span class="usuario-nombre"></span>, <span class="mensaje">Mensaje</span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-dark btn-modal-cerrar _trackear" data-dismiss="modal">Entendido</button>
                </div>
            </div>
        </div>
    </div>    

    <!-- Modal mini progreso -->
    <div class="modal _fade zindex-sobrecontrato" style="z-index:2000;" id="modal-mini-progreso" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="spinner-grow text-success" role="status"></span>&nbsp;
                    <strong class="mr-auto pt-1">Calculando...</strong>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg pl-2"></i></button>
                </div>
                <div class="modal-body pt-3 pb-4">
                    <span id="modal-mini-progreso-mensaje">Falta menos de <u>1</u> minuto</span>
                </div>
            </div>
        </div>
    </div>    

    <!-- Cobrar (debe estar aquí porque lo usan tanto cobros como ventas) -->
    <div class="modal fade w-99" id="modal-agenda-cobrar" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="ModalNuevoRecibo_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info text-light">
                    <h5 class="modal-title"><span class="font-weight-bold">Recibo: </span><span class="font-weight-bold" id="agenda-cobrar-reciboid">000000</span></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg pl-2"></i></button>
                </div>
                
            <form id="form-agenda-cobrar">

                <div class="modal-body py-0" style="min-height: 300px;">
                   
                    <!-- forma de pago -->

                    <!-- select -->
                    <div class="form-row mt-3">
                        <label for="select-forma-de-pago" class="text-secondary small">Forma de pago:</label>
                        <select class="form-control custom-select mx-1" id="select-forma-de-pago" style="cursor: pointer;">
                            <option value="E" selected>Efectivo</option>
                            <option value="T">Tarjeta</option>
                            <option value="S">Sinpe, transferencia</option>
                            <option value="C">Cheque</option>
                            <option value="P">Provisional</option>
                            <option value="H">Chash + noCash</option>
                        </select>
                    </div>                                       
                    <!--número de tarjeta, sinpe, depósito, provisional, o nota -->
                    <div class="form-row mt-2">
                        <div class="form-group col-12">
                            <input type="text" class="form-control cobrar-notas" id="agenda-cobrar-notas" placeholder="Número de referencia" _pattern="^[A-Za-z][A-Za-z0-9 -]*[A-Za-z0-9]$" _title="Debe comenzar con una letra">
                        </div>
                    </div>

                    <!-- Montos -->

                    <!-- cash -->
                    <div class="form-row border-top border-success border-3 mt-3 pt-3">
                        <div class="form-group col-5">
                            <label for="agenda-cobrar-monto-cash" class="text-secondary small"><i class="bi bi-cash-stack text-success lead pr-2"></i>Cash:</label>
                        </div>
                        <div class="form-group col-7">
                            <input type="number" class="form-control border-success text-right cobrar-cash" id="agenda-cobrar-monto-cash" placeholder="0" style="font-size:2rem!important;font-weight:300!important;">
                        </div>
                    </div>
                    <!-- nocash -->
                    <div class="form-row">
                        <div class="form-group col-5">
                            <label for="agenda-cobrar-monto-nocash" class="text-secondary small"><i class="bi bi-credit-card-2-back lead text-warning pr-2"></i>NO cash:</label>
                        </div>
                        <div class="form-group col-7 m-0">
                            <input type="number" class="form-control border-warning text-right cobrar-nocash" id="agenda-cobrar-monto-nocash" placeholder="0" style="font-size:2rem!important;font-weight:300!important;">
                        </div>
                    </div>
                    <!-- total -->
                    <div class="form-row border-bottom border-success border-3 mb-3">
                        <div class="form-group col-12 text-right m-0">
                            <span class="display-3 text-success cobrar-total" id="agenda-cobrar-monto-total" data-saldo="0">0.00</label>
                        </div>
                    </div>

                    <!-- check no adelantar -->
                    <div class="row lead ocultar-para-ventas">
                        <div class="col-12">
                            <div class="custom-control custom-checkbox">
                                <input class="custom-control-input" type="checkbox" id="agenda-noadelantar-check2">
                                <label class="custom-control-label small" for="agenda-noadelantar-check2">NO adelantar cuotas automáticas</label>
                            </div>
                        </div>
                    </div>

                    <!-- check no imprimir -->
                    <div class="row lead">
                        <div class="col-12">
                            <div class="custom-control custom-checkbox">
                                <input class="custom-control-input" type="checkbox" id="check-no-imprimir"> <!-- A partir de aquí se corta a veces el código durante la compilación (?) -->
                                <label class="custom-control-label small" for="check-no-imprimir">No imprimir</label>
                            </div>
                        </div>
                    </div>                    

                    <!-- nota cliente -->
                    <div class="row lead" id="agenda-cliente-nota">
                        <div class="col-12 border-top text-danger small mt-4">
                            <span class="font-weight-bold">NOTA: </span>
                            <span class="agenda-cliente-nota"></span>
                        </div>
                    </div>          
                    
                </div>

                <div class="modal-footer border-0">
                    <!--<button type="button" class="btn btn-outline-dark btn-lg" data-dismiss="modal" id="btn-agenda-cobrar-cerrar"><i class="bi bi-x-lg"></i></i></button>-->
                    <button type="submit" class="btn btn-success btn-lg ml-2 _trackear" id="btn-agenda-cobrar-submit">Confirmar<i class="bi bi-check-lg pl-2"></i></button>
                    <button type="button" class="btn btn-primary btn-lg oculto ml-2" id="btn-agenda-cobrar-reimprimir"><i class="bi bi-printer"></i></button>
                    <button type="button" class="btn btn-primary btn-lg ml-2 btn-recibo-email"><i class="bi bi-send"></i></button>
                    <button type="button" class="btn btn-secondary btn-lg ml-2 cursor-default btn-recibo-noemail" data-toggle="_tooltip" data-placement="top" title="Sin email"><i class="bi bi-send"></i></button>
                    <button type="button" class="btn btn-primary btn-lg ml-2 btn-compartir-recibos" data-contrato-id="contrato_id" data-recibo-id="recibo_id" data-cli-nombre="cli_nombre" data-cli-areacode="506" data-cli-telefono="cli_cel" data-cobro-tstamp="cobro_tstamp"><i class="bi bi-share-fill"></i></button>
                    <a class="btn btn-primary ml-2" href="#" role="button" id="btn-compartir-recibo-por-wa" target="_blank" rel="noreferrer"><i class="bi bi-whatsapp"></i></a>
                </div>

            </form>

            </div>
        </div>
    </div>

    <!-- Notas de gestión -->
    <div class="modal fade" id="modal-agenda-notas-gestion" tabindex="-1" role="dialog" aria-labelledby="ModalNuevoRecibo_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Notas de gestión</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg pl-2"></i></button>
                </div>
                <div class="modal-body">
                    <div class="small" id="notas-gestion-texto"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Historial de gestiones -->
    <div class="modal fade" id="modal-agenda-gestiones" tabindex="-1" role="dialog" aria-labelledby="ModalNuevoRecibo_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Gestiones recientes</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg pl-2"></i></button>
                </div>
                <div class="modal-body">
                    <table id="tabla-agenda-gestiones" class="table">
                        <thead>
                            <tr>
                                <th>Descripción</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Promo-acciones del cliente -->
    <div class="modal fade" id="modal-agenda-acciones" tabindex="-1" role="dialog" aria-labelledby="ModalNuevoRecibo_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Promoción</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg pl-2"></i></button>
                </div>
                <div class="modal-body">
                    <table id="tabla-agenda-acciones" class="table text-center">
                        <thead>
                            <tr>
                                <th>Acciones vigentes (<span id="agenda-acciones-cant">0</span>)</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Historial de pagos -->
    <div class="modal fade" id="modal-agenda-pagos" tabindex="-1" role="dialog" aria-labelledby="ModalNuevoRecibo_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><span class="_fw-bold">Histórico de pagos</span></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg pl-2"></i></button>
                </div>
                <div class="modal-body">                   
                    <!-- tabla -->
                    <table id="tabla-agenda-pagos" class="table mt-3">
                        <thead>
                            <tr>
                                <th>Detalles</th>
                                <th class="text-right"><div class="spinner-grow text-success ml-3 spinner-progreso" role="status"><span class="sr-only">Loading...</span></div></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <!-- Saldo del contrato -->
                    <span class="text-center text-black-50 font-italic mt-5"><i class="bi bi-cash-stack pr-2"></i>Saldo del contrato:&nbsp;<span class="font-weight-bold" id="agenda-saldo-contrato"></span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Días de cobro por zona -->
    <div class="modal fade con-backdrop" id="modal-infodias" tabindex="-1" role="dialog" aria-labelledby="modal-infodias-titulo"
        aria-hidden="true">
        <div class="modal-dialog _modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-light">
                    <h5 class="modal-title" id="modal-infodias-titulo">Sugerencia días de visita</h5>
                    <button type="button" class="close text-light" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Buscar dirección -->
                    <div id="div-infodias-buscar">
                        <div class="h3 pl-1 pr-3">¿Qué lugar buscas?</div>

                        <!-- input y btn -->
                        <div class="input-group my-4">
                            <input 
                                type="text" 
                                class="form-control py-4" 
                                aria-label="Buscar"
                                aria-describedby="btn-infodias-buscar" 
                                id="input-infodias-direccion"
                                placeholder="Escribe la dirección"
                            >
                            <button class="btn btn-primary" type="button" id="btn-infodias-buscar">Buscar</button>
                        </div>
                    </div>

                    <!-- Resultados de la búsqueda -->
                    <div class="mt-1 oculto" id="div-infodias-resultados">
                        <table class="w-100" id="tabla-infodias-resultados">
                            <thead>
                                <tr>
                                    <th class="bg-dark small text-light pl-1">DÍA</th>
                                    <th class="bg-dark small text-light text-center w-15">CANT</th>
                                    <th class="bg-dark small text-light _text-center pl-3">EJEMPLO</th>
                                    <th class="bg-dark small text-light text-right pr-1">AGENTE</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer d-none">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ERUDA 
    Ref: github.com/liriliri/eruda
    Uso: funerariaeleden.com/sys/?dev=true -->
    <script>
        ;(function () {
            let src = 'https://cdn.jsdelivr.net/npm/eruda';
            let script_ini = '<scr' + 'ipt';
            let script_fin = '</scr' + 'ipt>';
            if (!/dev=true/.test(window.location) && localStorage.getItem('active-eruda') != 'true') return;
            document.write(script_ini + ' src="' + src + '">' + script_fin);
            document.write(script_ini + '>eruda.init();' + script_fin);
        })();
    </script>

</body>
</html>
